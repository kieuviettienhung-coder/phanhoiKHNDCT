<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>G√≥p √ù Kh√°ch H√†ng - BVNƒê C·∫ßn Th∆°</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 50%, #15803d 100%);
            min-height: 100vh;
            padding: 0;
            padding-bottom: env(safe-area-inset-bottom);
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255,255,255,0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255,255,255,0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            position: relative;
            z-index: 1;
        }

        .container.admin {
            max-width: 1400px;
        }

        /* HEADER STYLES - T∆∞∆°i s√°ng h∆°n */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 28px 24px;
            border-radius: 24px;
            box-shadow: 
                0 8px 32px rgba(34, 197, 94, 0.2),
                0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid rgba(255,255,255,0.6);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 50%, #22c55e 100%);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% 0%; }
            50% { background-position: 100% 0%; }
        }

        .header h1 {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 24px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .header p {
            color: #64748b;
            font-size: 14px;
            margin-top: 8px;
            font-weight: 500;
        }

        /* BUTTON STYLES - Gradient v√† hover effects */
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 48px;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
            transform: translateY(-2px);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.4);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(74, 222, 128, 0.6);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(248, 113, 113, 0.4);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(248, 113, 113, 0.6);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(251, 146, 60, 0.4);
        }

        .btn-warning:hover {
            box-shadow: 0 6px 20px rgba(251, 146, 60, 0.6);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, #34d399 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 211, 153, 0.4);
        }

        .btn-success:hover {
            box-shadow: 0 6px 20px rgba(52, 211, 153, 0.6);
            transform: translateY(-2px);
        }

        /* CARD STYLES - Shadow v√† animation ƒë·∫πp h∆°n */
        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 24px;
            border-radius: 20px;
            box-shadow: 
                0 4px 20px rgba(34, 197, 94, 0.12),
                0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255,255,255,0.5);
        }

        .card:hover {
            box-shadow: 
                0 8px 32px rgba(34, 197, 94, 0.18),
                0 4px 12px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }

        /* FEEDBACK CARD - ƒê·∫πp h∆°n */
        .feedback-card {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            margin-bottom: 32px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid #22c55e;
            position: relative;
            overflow: hidden;
        }

        .feedback-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #22c55e15 0%, transparent 100%);
            border-radius: 0 0 0 100px;
        }

        .feedback-card:hover {
            box-shadow: 0 8px 30px rgba(34, 197, 94, 0.2);
            transform: translateY(-4px);
        }

        /* FEEDBACK ITEM - Ph√¢n c√°ch b·∫±ng ƒë∆∞·ªùng k·∫ª */
        .feedback-item {
            padding: 20px 0;
            border-bottom: 4px double #d1d5db;
        }

        .feedback-item:last-child {
            border-bottom: none;
        }

        /* BADGES - Gradient ƒë·∫πp */
        .satisfaction-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-right: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .satisfaction-badge.happy {
            background: linear-gradient(135deg, #34d399 0%, #059669 100%);
            color: white;
        }

        .satisfaction-badge.neutral {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
        }

        .satisfaction-badge.sad {
            background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);
            color: white;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }

        .status-badge.status-new {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            color: white;
        }

        .status-badge.status-processing {
            background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);
            color: white;
        }

        .status-badge.status-resolved {
            background: linear-gradient(135deg, #34d399 0%, #059669 100%);
            color: white;
        }

        /* FORM STYLES */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #1e293b;
            font-weight: 600;
            font-size: 15px;
        }

        .required {
            color: #ef4444;
            margin-left: 4px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }

        /* SATISFACTION OPTIONS - ƒê·∫πp h∆°n */
        .satisfaction-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .satisfaction-option {
            padding: 28px;
            border: 3px solid #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: 700;
            font-size: 18px;
            position: relative;
            overflow: hidden;
        }

        .satisfaction-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .satisfaction-option.happy::before {
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
        }

        .satisfaction-option.neutral::before {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
        }

        .satisfaction-option.sad::before {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
        }

        .satisfaction-option:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .satisfaction-option:hover::before {
            opacity: 1;
        }

        .satisfaction-option.selected {
            border-width: 3px;
            box-shadow: 0 8px 28px rgba(0,0,0,0.15);
            transform: scale(1.02);
        }

        .satisfaction-option.happy.selected {
            border-color: #22c55e;
            background: linear-gradient(135deg, #22c55e15 0%, #16a34a15 100%);
        }

        .satisfaction-option.neutral.selected {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #f59e0b15 0%, #d9770615 100%);
        }

        .satisfaction-option.sad.selected {
            border-color: #ef4444;
            background: linear-gradient(135deg, #ef444415 0%, #dc262615 100%);
        }

        .satisfaction-option.selected::before {
            opacity: 1;
        }

        .satisfaction-option .emoji {
            font-size: 48px;
        }

        .satisfaction-emoji {
            font-size: 48px;
            line-height: 1;
        }

        .satisfaction-label {
            font-size: 18px;
            font-weight: 700;
        }

        /* ACTIONS */
        .feedback-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 16px;
        }

        .feedback-actions .btn {
            font-size: 13px;
            padding: 8px 12px;
            min-height: 36px;
        }

        /* STATS - ƒê·∫πp h∆°n */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .stat-card .stat-number {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .stat-card .stat-label {
            color: #64748b;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* FILTERS */
        .filters {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        /* SUCCESS MESSAGE */
        .success-message {
            background: linear-gradient(135deg, #34d399 0%, #059669 100%);
            color: white;
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 8px 30px rgba(52, 211, 153, 0.4);
            animation: slideInUp 0.5s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-message h2 {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .success-message p {
            font-size: 16px;
            opacity: 0.95;
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* RESPONSIVE */
        /* MOBILE BOTTOM NAVIGATION - iPhone Style */
        .mobile-nav {
            display: none;
        }

        .mobile-nav-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 2px solid rgba(34, 197, 94, 0.2);
            padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
            box-shadow: 
                0 -8px 32px rgba(34, 197, 94, 0.15),
                0 -2px 8px rgba(0, 0, 0, 0.05);
            z-index: 1000;
        }

        .mobile-nav-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0;
            max-width: 100%;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px 4px;
            cursor: pointer;
            text-decoration: none;
            color: #64748b;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            min-height: 68px;
            border-radius: 12px;
            margin: 0 4px;
        }

        .mobile-nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 3px;
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
            border-radius: 0 0 8px 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .mobile-nav-item.active {
            color: #16a34a;
            background: rgba(34, 197, 94, 0.08);
        }

        .mobile-nav-item.active::before {
            opacity: 1;
        }

        .mobile-nav-item:active {
            transform: scale(0.95);
        }

        .mobile-nav-item .nav-icon {
            font-size: 26px;
            margin-bottom: 4px;
            transition: transform 0.3s;
        }

        .mobile-nav-item .nav-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .mobile-nav-item.active .nav-icon {
            transform: scale(1.15);
        }

        /* Hide desktop header on mobile when logged in */
        .admin-header-desktop {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
                padding-bottom: 80px; /* Space for bottom nav */
            }

            .container.admin {
                padding-bottom: calc(80px + env(safe-area-inset-bottom));
            }

            .header h1 {
                font-size: 22px;
            }

            .btn {
                padding: 12px 16px;
                font-size: 14px;
            }

            .stat-card .stat-number {
                font-size: 28px;
            }

            .feedback-card {
                padding: 16px;
                margin-bottom: 24px;
            }

            .satisfaction-option {
                padding: 20px;
            }

            .satisfaction-emoji {
                font-size: 40px;
            }

            /* Show mobile nav on mobile for admin */
            .mobile-nav {
                display: block;
            }

            .admin-header-desktop {
                display: none;
            }

            /* Make header simpler on mobile */
            .header.admin-header {
                padding: 12px;
                margin-bottom: 12px;
            }

            /* Adjust stats grid for mobile */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            /* Make filters vertical on mobile */
            .filter-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            /* Better button sizing for touch */
            .feedback-actions {
                gap: 8px;
            }

            .feedback-actions .btn {
                font-size: 13px;
                padding: 10px 14px;
                min-height: 44px; /* iOS touch target */
            }
        }

        /* NOTIFICATION BADGE */
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-radius: 12px;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 8px;
            color: #1e293b;
        }

        .empty-state p {
            font-size: 14px;
        }

        /* ADMIN FOOTER */
        .admin-footer {
            text-align: center;
            margin-top: 32px;
            padding: 24px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 2px dashed rgba(34, 197, 94, 0.3);
        }

        .admin-footer p {
            color: #64748b;
            font-size: 13px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .btn-outline {
            background: transparent;
            color: #16a34a;
            border: 2px solid #22c55e;
            font-weight: 700;
        }

        .btn-outline:hover {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border-color: #16a34a;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // EmailJS Configuration - THAY B·∫∞NG TH√îNG TIN C·ª¶A B·∫†N (T√ôY CH·ªåN)
        const EMAILJS_SERVICE_ID = 'THAY_SERVICE_ID_CUA_BAN';  // V√≠ d·ª•: 'service_bvnd123'
        const EMAILJS_TEMPLATE_ID = 'THAY_TEMPLATE_ID_CUA_BAN'; // V√≠ d·ª•: 'template_feedback123'
        const EMAILJS_PUBLIC_KEY = 'THAY_PUBLIC_KEY_CUA_BAN';   // V√≠ d·ª•: 'user_1234567890abcdef'

        // Telegram Bot Configuration - ƒê√É C·∫§U H√åNH S·∫¥N
        const TELEGRAM_BOT_TOKEN = '8223316349:AAF5nm35vokxZfYJh4Wcdz_iuSItyN_E5uU';
        const TELEGRAM_CHAT_ID = '5718070140';

        const firebaseConfig = {
            apiKey: "AIzaSyA5187r8QLGAHe89fD0OLwU0LTLRyz_rFU",
            authDomain: "bvnd-cantho-feedback-26b67.firebaseapp.com",
            databaseURL: "https://bvnd-cantho-feedback-26b67-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "bvnd-cantho-feedback-26b67",
            storageBucket: "bvnd-cantho-feedback-26b67.firebasestorage.app",
            messagingSenderId: "496570009674",
            appId: "1:496570009674:web:9adfb9ee89f3febddf7eb3",
            measurementId: "G-WNQ6221DEL"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const db = firebase.database();
        const auth = firebase.auth();

        // Main App Component
        function App() {
            const [currentView, setCurrentView] = useState('form');
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                    setLoading(false);
                    if (user && currentView === 'form') {
                        setCurrentView('qr');
                    }
                });
                return unsubscribe;
            }, []);

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <p>ƒêang t·∫£i...</p>
                    </div>
                );
            }

            const isAdmin = user !== null;
            const showCustomerView = !user && currentView === 'form';

            return (
                <div className={`container ${isAdmin ? 'admin' : ''}`}>
                    {showCustomerView ? (
                        // Customer view with admin button at bottom
                        <>
                            <div className="header">
                                <div style={{ 
                                    display: 'flex', 
                                    flexDirection: 'column',
                                    alignItems: 'center',
                                    gap: '20px'
                                }}>
                                    {/* Logo */}
                                    <img 
                                        src="logo.png" 
                                        alt="Logo BVNƒê C·∫ßn Th∆°"
                                        style={{ 
                                            width: '140px',
                                            height: 'auto',
                                            filter: 'drop-shadow(0 4px 12px rgba(0,0,0,0.1))'
                                        }}
                                        onError={(e) => { e.target.style.display = 'none' }}
                                    />
                                    
                                    {/* Title Section */}
                                    <div style={{ textAlign: 'center' }}>
                                        <h1 style={{ 
                                            fontSize: '28px', 
                                            marginBottom: '12px',
                                            background: 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',
                                            WebkitBackgroundClip: 'text',
                                            WebkitTextFillColor: 'transparent',
                                            backgroundClip: 'text',
                                            fontWeight: '800',
                                            letterSpacing: '-0.5px'
                                        }}>
                                            G√ìP √ù KH√ÅCH H√ÄNG
                                        </h1>
                                        <h2 style={{ 
                                            fontSize: '18px', 
                                            color: '#1e40af', 
                                            fontWeight: '700', 
                                            marginBottom: '8px' 
                                        }}>
                                            B·ªánh vi·ªán Nhi ƒë·ªìng TP C·∫ßn Th∆°
                                        </h2>
                                        <p style={{ 
                                            fontSize: '15px', 
                                            margin: 0,
                                            color: '#64748b',
                                            fontWeight: '500',
                                            fontStyle: 'italic'
                                        }}>
                                            ‚ú® √ù ki·∫øn c·ªßa b·∫°n gi√∫p ch√∫ng t√¥i ph·ª•c v·ª• t·ªët h∆°n
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <FeedbackForm />
                            
                            {/* Admin access button */}
                            <div className="admin-footer">
                                <p>Qu·∫£n tr·ªã vi√™n</p>
                                <button 
                                    className="btn btn-outline"
                                    onClick={() => setCurrentView('login')}
                                >
                                    üîê ƒêƒÉng Nh·∫≠p Qu·∫£n L√Ω
                                </button>
                            </div>
                        </>
                    ) : (
                        // Admin view
                        <>
                            <AdminHeader 
                                currentView={currentView} 
                                setCurrentView={setCurrentView}
                                user={user}
                                setUser={setUser}
                            />
                            
                            {currentView === 'qr' && user && <QRGenerator />}
                            {currentView === 'admin' && user && <AdminDashboard />}
                            {currentView === 'reports' && user && <Reports />}
                            {currentView === 'login' && <Login setUser={setUser} setCurrentView={setCurrentView} />}
                        </>
                    )}
                </div>
            );
        }

        // Admin Header Component
        function AdminHeader({ currentView, setCurrentView, user, setUser }) {
            const [unreadCount, setUnreadCount] = useState(0);

            useEffect(() => {
                if (user) {
                    const feedbackRef = db.ref('feedbacks');
                    feedbackRef.on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            const count = Object.values(data).filter(f => f.status === 'new').length;
                            setUnreadCount(count);
                        }
                    });
                }
            }, [user]);

            const handleLogout = () => {
                auth.signOut();
                setUser(null);
                setCurrentView('form');
            };

            return (
                <>
                    {/* Desktop Header */}
                    <div className="header admin-header-desktop">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                                <img 
                                    src="logo.png" 
                                    alt="Logo BVNƒê"
                                    style={{ 
                                        width: '60px',
                                        height: 'auto'
                                    }}
                                    onError={(e) => { e.target.style.display = 'none' }}
                                />
                                <div>
                                    <h1 style={{ fontSize: '18px', marginBottom: '4px' }}>Qu·∫£n L√Ω G√≥p √ù</h1>
                                    <p style={{ fontSize: '14px', color: '#3b82f6', margin: 0 }}>B·ªánh vi·ªán Nhi ƒë·ªìng TP C·∫ßn Th∆°</p>
                                </div>
                            </div>
                            <div className="header-buttons">
                                <button 
                                    className={`btn ${currentView === 'admin' ? 'btn-primary' : 'btn-secondary'} btn-icon`}
                                    onClick={() => setCurrentView('admin')}
                                >
                                    üìä
                                    {unreadCount > 0 && currentView !== 'admin' && (
                                        <span className="notification-badge">{unreadCount}</span>
                                    )}
                                </button>
                                <button 
                                    className={`btn ${currentView === 'qr' ? 'btn-primary' : 'btn-secondary'} btn-icon`}
                                    onClick={() => setCurrentView('qr')}
                                    title="T·∫°o QR Code"
                                >
                                    üì±
                                </button>
                                <button 
                                    className={`btn ${currentView === 'reports' ? 'btn-primary' : 'btn-warning'} btn-icon`}
                                    onClick={() => setCurrentView('reports')}
                                    title="Xu·∫•t B√°o C√°o"
                                >
                                    üìÑ
                                </button>
                                <button 
                                    className="btn btn-danger btn-icon"
                                    onClick={handleLogout}
                                >
                                    üö™
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Mobile Bottom Navigation */}
                    <div className="mobile-nav">
                        <div className="mobile-nav-bottom">
                            <div className="mobile-nav-grid">
                                <div 
                                    className={`mobile-nav-item ${currentView === 'admin' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('admin')}
                                >
                                    <div className="nav-icon" style={{ position: 'relative' }}>
                                        üìä
                                        {unreadCount > 0 && currentView !== 'admin' && (
                                            <span className="notification-badge">{unreadCount}</span>
                                        )}
                                    </div>
                                    <div className="nav-label">G√≥p √ù</div>
                                </div>
                                <div 
                                    className={`mobile-nav-item ${currentView === 'qr' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('qr')}
                                >
                                    <div className="nav-icon">üì±</div>
                                    <div className="nav-label">QR Code</div>
                                </div>
                                <div 
                                    className={`mobile-nav-item ${currentView === 'reports' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('reports')}
                                >
                                    <div className="nav-icon">üìÑ</div>
                                    <div className="nav-label">B√°o C√°o</div>
                                </div>
                                <div 
                                    className="mobile-nav-item"
                                    onClick={handleLogout}
                                >
                                    <div className="nav-icon">üö™</div>
                                    <div className="nav-label">Tho√°t</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </>
            );
        }

        // QR Generator Component
        // QR Generator Component
        function QRGenerator() {
            const qrRef = useRef(null);
            const [qrGenerated, setQrGenerated] = useState(false);

            useEffect(() => {
                if (!qrGenerated && qrRef.current) {
                    qrRef.current.innerHTML = '';
                    
                    const currentUrl = window.location.href.split('?')[0];
                    
                    new QRCode(qrRef.current, {
                        text: currentUrl,
                        width: 300,
                        height: 300,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                    
                    setQrGenerated(true);
                }
            }, [qrGenerated]);

            const handleDownload = () => {
                const canvas = qrRef.current.querySelector('canvas');
                if (canvas) {
                    const url = canvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.download = 'QR-Gop-Y-BVND-CanTho.png';
                    link.href = url;
                    link.click();
                }
            };

            const handlePrint = () => {
                window.print();
            };

            const handleCopyLink = () => {
                const url = window.location.href.split('?')[0];
                navigator.clipboard.writeText(url).then(() => {
                    alert('‚úÖ ƒê√£ copy link v√†o clipboard!');
                });
            };

            return (
                <div className="qr-section">
                    <div style={{ 
                        display: 'flex', 
                        alignItems: 'center', 
                        gap: '20px',
                        marginBottom: '20px',
                        padding: '15px',
                        background: 'white',
                        borderRadius: '12px'
                    }}>
                        <img 
                            src="logo.png" 
                            alt="Logo BVNƒê"
                            style={{ 
                                width: '100px',
                                height: 'auto',
                                flexShrink: 0
                            }}
                            onError={(e) => { e.target.style.display = 'none' }}
                        />
                        <div style={{ flex: 1, textAlign: 'left' }}>
                            <h2 style={{ marginBottom: '8px', fontSize: '20px', color: '#667eea' }}>üì± QR Code G√≥p √ù Kh√°ch H√†ng</h2>
                            <h3 style={{ fontSize: '16px', color: '#2d3748', margin: 0 }}>B·ªánh vi·ªán Nhi ƒë·ªìng TP C·∫ßn Th∆°</h3>
                        </div>
                    </div>
                    <p style={{ textAlign: 'center', marginBottom: '25px', fontSize: '15px' }}>
                        Kh√°ch h√†ng qu√©t m√£ QR n√†y ƒë·ªÉ g·ª≠i g√≥p √Ω tr·ª±c ti·∫øp.<br/>
                        <strong style={{ color: '#22c55e' }}>Kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p - T·ªëi ∆∞u cho ƒëi·ªán tho·∫°i</strong>
                    </p>
                    
                    <div style={{
                        display: 'flex',
                        justifyContent: 'center',
                        marginBottom: '25px'
                    }}>
                        <div style={{
                            padding: '30px',
                            background: 'white',
                            borderRadius: '20px',
                            border: '3px solid #e5e7eb',
                            boxShadow: '0 4px 20px rgba(0,0,0,0.1)',
                            display: 'inline-block'
                        }}>
                            <div ref={qrRef} id="qrcode"></div>
                            <p style={{
                                textAlign: 'center',
                                marginTop: '15px',
                                fontSize: '14px',
                                color: '#64748b',
                                fontWeight: '600'
                            }}>
                                QU√âT ƒê·ªÇ G√ìP √ù
                            </p>
                        </div>
                    </div>
                    
                    <div className="qr-actions">
                        <button className="btn btn-primary" onClick={handleDownload}>
                            üíæ T·∫£i QR Code
                        </button>
                        <button className="btn btn-secondary" onClick={handlePrint}>
                            üñ®Ô∏è In QR Code
                        </button>
                        <button className="btn btn-warning" onClick={handleCopyLink}>
                            üìã Copy Link
                        </button>
                    </div>

                    <div style={{ marginTop: '30px', padding: '20px', background: '#f7fafc', borderRadius: '12px', textAlign: 'left' }}>
                        <h3 style={{ color: '#667eea', marginBottom: '15px', fontSize: '16px' }}>
                            üí° H∆∞·ªõng d·∫´n:
                        </h3>
                        <ol style={{ color: '#718096', lineHeight: '2', paddingLeft: '20px' }}>
                            <li>T·∫£i v√† in QR code</li>
                            <li>D√°n t·∫°i qu·∫ßy l·ªÖ t√¢n, ph√≤ng kh√°m</li>
                            <li>Kh√°ch h√†ng qu√©t m√£ b·∫±ng camera</li>
                            <li>Form g√≥p √Ω t·ª± ƒë·ªông m·ªü</li>
                            <li>Kh√°ch kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p!</li>
                        </ol>
                        
                        <div style={{ marginTop: '20px', padding: '15px', background: 'white', borderRadius: '8px', border: '2px solid #667eea' }}>
                            <strong style={{ color: '#667eea' }}>ü§ñ Th√¥ng b√°o Telegram:</strong>
                            <p style={{ marginTop: '8px', fontSize: '14px' }}>
                                Khi c√≥ g√≥p √Ω m·ªõi, b·∫°n s·∫Ω nh·∫≠n th√¥ng b√°o <strong>T·ª®C TH√å</strong> qua Telegram Bot!<br/>
                                ‚ö° Nhanh ch√≥ng (3-5 gi√¢y)<br/>
                                üîî Tin c·∫≠y 100%<br/>
                                üì± Tap l√† m·ªü app ngay
                            </p>
                        </div>

                        <div style={{ marginTop: '15px', padding: '15px', background: '#fffaf0', borderRadius: '8px', border: '2px solid #ed8936' }}>
                            <strong style={{ color: '#ed8936' }}>üìß Email Backup:</strong>
                            <p style={{ marginTop: '8px', fontSize: '14px' }}>
                                Email s·∫Ω ƒë∆∞·ª£c g·ª≠i t·ªõi: <strong>kieuviettienhung@gmail.com</strong><br/>
                                (ƒë·ªÉ l∆∞u tr·ªØ v√† tham kh·∫£o sau)
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // Feedback Form Component
        function FeedbackForm() {
            const [formData, setFormData] = useState({
                name: '',
                phone: '',
                content: '',
                satisfaction: '',
                room: ''
            });
            const [submitting, setSubmitting] = useState(false);
            const [success, setSuccess] = useState(false);

            const satisfactionOptions = [
                { value: 'happy', emoji: 'üòä', label: 'H√†i L√≤ng', class: 'happy' },
                { value: 'neutral', emoji: 'üòê', label: 'B√¨nh Th∆∞·ªùng', class: 'neutral' },
                { value: 'sad', emoji: 'üòû', label: 'Kh√¥ng H√†i L√≤ng', class: 'sad' }
            ];

            // Initialize EmailJS
            useEffect(() => {
                if (EMAILJS_PUBLIC_KEY !== 'THAY_PUBLIC_KEY_CUA_BAN') {
                    emailjs.init(EMAILJS_PUBLIC_KEY);
                }
            }, []);

            const sendTelegramNotification = async (feedbackData) => {
                // Check if Telegram is configured
                if (TELEGRAM_BOT_TOKEN === 'THAY_BOT_TOKEN_CUA_BAN') {
                    console.log('Telegram ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh');
                    return;
                }

                try {
                    // Determine satisfaction emoji and text
                    let satisfactionEmoji = '';
                    let satisfactionText = '';
                    
                    switch(feedbackData.satisfaction) {
                        case 'happy':
                            satisfactionEmoji = 'üòä';
                            satisfactionText = 'H√ÄI L√íNG';
                            break;
                        case 'neutral':
                            satisfactionEmoji = 'üòê';
                            satisfactionText = 'B√åNH TH∆Ø·ªúNG';
                            break;
                        case 'sad':
                            satisfactionEmoji = 'üòû';
                            satisfactionText = 'KH√îNG H√ÄI L√íNG';
                            break;
                    }

                    // Format message
                    const message = `üÜï <b>G√ìP √ù M·ªöI</b>

üë§ <b>H·ªç t√™n:</b> ${feedbackData.name || 'Kh√°ch h√†ng'}
üì± <b>SƒêT:</b> ${feedbackData.phone || 'Kh√¥ng cung c·∫•p'}
üè• <b>Ph√≤ng:</b> ${feedbackData.room}
${satisfactionEmoji} <b>ƒê√°nh gi√°:</b> ${satisfactionText}
üïí <b>Th·ªùi gian:</b> ${new Date().toLocaleString('vi-VN')}

üí¨ <b>N·ªôi dung:</b>
${feedbackData.content}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a href="https://kieuviettienhung-coder.github.io/phanhoiKHNDCT/?view=login">üìä Xem chi ti·∫øt tr√™n Dashboard</a>`;


                    // Send to Telegram
                    const telegramApiUrl = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
                    
                    const response = await fetch(telegramApiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: TELEGRAM_CHAT_ID,
                            text: message,
                            parse_mode: 'HTML',
                            disable_web_page_preview: false
                        })
                    });

                    if (response.ok) {
                        console.log('‚úÖ Telegram notification sent successfully!');
                    } else {
                        const error = await response.json();
                        console.error('‚ùå Telegram API error:', error);
                    }
                } catch (error) {
                    console.error('‚ùå Failed to send Telegram notification:', error);
                    // Don't show error to user - notification is just a bonus
                }
            };

            const sendEmailNotification = async (feedbackData) => {
                // Check if EmailJS is configured
                if (EMAILJS_PUBLIC_KEY === 'THAY_PUBLIC_KEY_CUA_BAN') {
                    console.log('EmailJS ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh');
                    return;
                }

                try {
                    // Determine satisfaction text and color
                    let satisfactionText = '';
                    let satisfactionColor = '';
                    
                    switch(feedbackData.satisfaction) {
                        case 'happy':
                            satisfactionText = 'üòä H√ÄI L√íNG';
                            satisfactionColor = '#48bb78';
                            break;
                        case 'neutral':
                            satisfactionText = 'üòê B√åNH TH∆Ø·ªúNG';
                            satisfactionColor = '#ed8936';
                            break;
                        case 'sad':
                            satisfactionText = 'üòû KH√îNG H√ÄI L√íNG';
                            satisfactionColor = '#f56565';
                            break;
                    }

                    const templateParams = {
                        from_name: feedbackData.name || 'Kh√°ch h√†ng',
                        phone: feedbackData.phone || 'Kh√¥ng cung c·∫•p',
                        room_number: feedbackData.room,
                        message: feedbackData.content,
                        satisfaction_text: satisfactionText,
                        satisfaction_color: satisfactionColor,
                        timestamp: new Date().toLocaleString('vi-VN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }),
                        to_email: 'kieuviettienhung@gmail.com'
                    };

                    await emailjs.send(
                        EMAILJS_SERVICE_ID,
                        EMAILJS_TEMPLATE_ID,
                        templateParams
                    );

                    console.log('‚úÖ Email notification sent successfully!');
                } catch (error) {
                    console.error('‚ùå Failed to send email notification:', error);
                    // Don't show error to user - email is just a notification
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!formData.content || !formData.satisfaction || !formData.room) {
                    alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!');
                    return;
                }

                setSubmitting(true);

                try {
                    const feedbackData = {
                        name: formData.name || 'Kh√°ch h√†ng',
                        phone: formData.phone || 'Kh√¥ng cung c·∫•p',
                        content: formData.content,
                        satisfaction: formData.satisfaction,
                        room: formData.room,
                        status: 'new',
                        createdAt: new Date().toISOString()
                    };

                    await db.ref('feedbacks').push(feedbackData);

                    // Send Telegram notification (fast - priority)
                    await sendTelegramNotification(feedbackData);

                    // Send email notification (backup)
                    await sendEmailNotification(feedbackData);

                    setSuccess(true);
                    setFormData({
                        name: '',
                        phone: '',
                        content: '',
                        satisfaction: '',
                        room: ''
                    });

                    window.scrollTo({ top: 0, behavior: 'smooth' });

                    setTimeout(() => setSuccess(false), 5000);
                } catch (error) {
                    console.error('Error submitting feedback:', error);
                    alert('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!');
                } finally {
                    setSubmitting(false);
                }
            };

            return (
                <div className="card">
                    {success && (
                        <div className="success-message">
                            <h3>‚úÖ G·ª≠i Th√†nh C√¥ng!</h3>
                            <p>C·∫£m ∆°n b·∫°n ƒë√£ g·ª≠i √Ω ki·∫øn. Ch√∫ng t√¥i s·∫Ω xem x√©t v√† ph·∫£n h·ªìi s·ªõm nh·∫•t!</p>
                        </div>
                    )}

                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label>üë§ H·ªç v√† T√™n (T√πy ch·ªçn)</label>
                            <input
                                type="text"
                                placeholder="Nh·∫≠p h·ªç t√™n c·ªßa b·∫°n"
                                value={formData.name}
                                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                            />
                        </div>

                        <div className="form-group">
                            <label>üì± S·ªë ƒêi·ªán Tho·∫°i (T√πy ch·ªçn)</label>
                            <input
                                type="tel"
                                placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"
                                value={formData.phone}
                                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                            />
                            <p style={{ fontSize: '13px', color: '#718096', marginTop: '5px', fontStyle: 'italic' }}>
                                üí° ƒê·ªÉ gi√∫p B·ªánh vi·ªán ph·∫£n h·ªìi s·ªõm nh·∫•t
                            </p>
                        </div>

                        <div className="form-group">
                            <label>üè• S·ªë ph√≤ng kh√°m/Bu·ªìng b·ªánh <span className="required">*</span></label>
                            <input
                                type="text"
                                placeholder="V√≠ d·ª•: Ph√≤ng 5, Bu·ªìng 102, P3..."
                                value={formData.room}
                                onChange={(e) => setFormData({ ...formData, room: e.target.value })}
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label>üòä M·ª©c ƒê·ªô H√†i L√≤ng <span className="required">*</span></label>
                            <div className="satisfaction-options">
                                {satisfactionOptions.map(option => (
                                    <div
                                        key={option.value}
                                        className={`satisfaction-option ${option.class} ${formData.satisfaction === option.value ? 'selected' : ''}`}
                                        onClick={() => setFormData({ ...formData, satisfaction: option.value })}
                                    >
                                        <div className="satisfaction-emoji">{option.emoji}</div>
                                        <div className="satisfaction-label">{option.label}</div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="form-group">
                            <label>üí¨ N·ªôi Dung G√≥p √ù <span className="required">*</span></label>
                            <textarea
                                placeholder="Nh·∫≠p n·ªôi dung g√≥p √Ω c·ªßa b·∫°n..."
                                value={formData.content}
                                onChange={(e) => setFormData({ ...formData, content: e.target.value })}
                                required
                            />
                        </div>

                        <button 
                            type="submit" 
                            className="btn btn-primary" 
                            style={{ width: '100%', fontSize: '18px', padding: '16px' }}
                            disabled={submitting}
                        >
                            {submitting ? '‚è≥ ƒêang G·ª≠i...' : 'üì§ G·ª≠i G√≥p √ù'}
                        </button>
                    </form>
                </div>
            );
        }

        // Admin Dashboard Component (simplified - copy from previous version)
        function AdminDashboard() {
            const [feedbacks, setFeedbacks] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filters, setFilters] = useState({
                satisfaction: '',
                room: '',
                status: '',
                search: ''
            });
            const [stats, setStats] = useState({
                total: 0,
                happy: 0,
                neutral: 0,
                sad: 0,
                new: 0
            });
            const [responseModal, setResponseModal] = useState({
                show: false,
                feedbackId: null,
                response: ''
            });
            const [transferModal, setTransferModal] = useState({
                show: false,
                feedbackId: null,
                assignTo: '',
                reason: ''
            });

            useEffect(() => {
                const feedbackRef = db.ref('feedbacks');
                feedbackRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const feedbackList = Object.entries(data).map(([id, feedback]) => ({
                            id,
                            ...feedback
                        })).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        
                        setFeedbacks(feedbackList);
                        
                        const newStats = {
                            total: feedbackList.length,
                            happy: feedbackList.filter(f => f.satisfaction === 'happy').length,
                            neutral: feedbackList.filter(f => f.satisfaction === 'neutral').length,
                            sad: feedbackList.filter(f => f.satisfaction === 'sad').length,
                            new: feedbackList.filter(f => f.status === 'new').length
                        };
                        setStats(newStats);
                    }
                    setLoading(false);
                });

                return () => feedbackRef.off();
            }, []);

            const updateStatus = async (feedbackId, newStatus) => {
                try {
                    const updates = {
                        status: newStatus
                    };
                    
                    // Add timestamp when status changes to resolved
                    if (newStatus === 'resolved') {
                        updates.resolvedAt = new Date().toISOString();
                    }
                    
                    await db.ref(`feedbacks/${feedbackId}`).update(updates);
                } catch (error) {
                    console.error('Error updating status:', error);
                    alert('C√≥ l·ªói x·∫£y ra!');
                }
            };

            const openResponseModal = (feedbackId) => {
                const feedback = feedbacks.find(f => f.id === feedbackId);
                setResponseModal({
                    show: true,
                    feedbackId: feedbackId,
                    response: feedback.response || ''
                });
            };

            const closeResponseModal = () => {
                setResponseModal({
                    show: false,
                    feedbackId: null,
                    response: ''
                });
            };

            const saveResponse = async () => {
                if (!responseModal.response.trim()) {
                    alert('Vui l√≤ng nh·∫≠p n·ªôi dung ph·∫£n h·ªìi!');
                    return;
                }

                try {
                    await db.ref(`feedbacks/${responseModal.feedbackId}`).update({
                        response: responseModal.response,
                        responseAt: new Date().toISOString(),
                        status: 'resolved',
                        resolvedAt: new Date().toISOString()
                    });
                    closeResponseModal();
                } catch (error) {
                    console.error('Error saving response:', error);
                    alert('C√≥ l·ªói x·∫£y ra!');
                }
            };

            const openTransferModal = (feedbackId) => {
                setTransferModal({
                    show: true,
                    feedbackId: feedbackId,
                    assignTo: '',
                    reason: ''
                });
            };

            const closeTransferModal = () => {
                setTransferModal({
                    show: false,
                    feedbackId: null,
                    assignTo: '',
                    reason: ''
                });
            };

            const saveTransfer = async () => {
                if (!transferModal.assignTo.trim()) {
                    alert('Vui l√≤ng nh·∫≠p t√™n ng∆∞·ªùi ƒë∆∞·ª£c chuy·ªÉn!');
                    return;
                }
                if (!transferModal.reason.trim()) {
                    alert('Vui l√≤ng nh·∫≠p l√Ω do chuy·ªÉn!');
                    return;
                }

                try {
                    const feedback = feedbacks.find(f => f.id === transferModal.feedbackId);
                    const transferHistory = feedback.transferHistory || [];
                    
                    transferHistory.push({
                        to: transferModal.assignTo,
                        reason: transferModal.reason,
                        transferredAt: new Date().toISOString()
                    });

                    await db.ref(`feedbacks/${transferModal.feedbackId}`).update({
                        assignTo: transferModal.assignTo,
                        transferHistory: transferHistory,
                        lastTransferAt: new Date().toISOString()
                    });
                    
                    closeTransferModal();
                } catch (error) {
                    console.error('Error transferring:', error);
                    alert('C√≥ l·ªói x·∫£y ra!');
                }
            };

            const deleteFeedback = async (feedbackId) => {
                if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a g√≥p √Ω n√†y?')) {
                    try {
                        await db.ref(`feedbacks/${feedbackId}`).remove();
                    } catch (error) {
                        console.error('Error deleting feedback:', error);
                        alert('C√≥ l·ªói x·∫£y ra!');
                    }
                }
            };

            const filteredFeedbacks = feedbacks.filter(feedback => {
                if (filters.satisfaction && feedback.satisfaction !== filters.satisfaction) return false;
                if (filters.room && !feedback.room.toLowerCase().includes(filters.room.toLowerCase())) return false;
                if (filters.status && feedback.status !== filters.status) return false;
                if (filters.search) {
                    const searchLower = filters.search.toLowerCase();
                    return (
                        feedback.content.toLowerCase().includes(searchLower) ||
                        feedback.name.toLowerCase().includes(searchLower) ||
                        feedback.phone.includes(searchLower)
                    );
                }
                return true;
            });

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <p>ƒêang t·∫£i...</p>
                    </div>
                );
            }

            return (
                <div>
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-number">{stats.total}</div>
                            <div className="stat-label">T·ªïng G√≥p √ù</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number" style={{ color: '#48bb78' }}>{stats.happy}</div>
                            <div className="stat-label">H√†i L√≤ng</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number" style={{ color: '#ed8936' }}>{stats.neutral}</div>
                            <div className="stat-label">B√¨nh Th∆∞·ªùng</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number" style={{ color: '#f56565' }}>{stats.sad}</div>
                            <div className="stat-label">Kh√¥ng H√†i L√≤ng</div>
                        </div>
                    </div>

                    <div className="filters">
                        <h3>üîç B·ªô L·ªçc</h3>
                        <div className="filters-grid">
                            <div className="form-group" style={{ marginBottom: 0 }}>
                                <label>M·ª©c ƒë·ªô</label>
                                <select
                                    value={filters.satisfaction}
                                    onChange={(e) => setFilters({ ...filters, satisfaction: e.target.value })}
                                >
                                    <option value="">T·∫•t c·∫£</option>
                                    <option value="happy">H√†i l√≤ng</option>
                                    <option value="neutral">B√¨nh th∆∞·ªùng</option>
                                    <option value="sad">Kh√¥ng h√†i l√≤ng</option>
                                </select>
                            </div>
                            <div className="form-group" style={{ marginBottom: 0 }}>
                                <label>Ph√≤ng/Bu·ªìng</label>
                                <input
                                    type="text"
                                    placeholder="T√¨m theo s·ªë ph√≤ng/bu·ªìng..."
                                    value={filters.room}
                                    onChange={(e) => setFilters({ ...filters, room: e.target.value })}
                                />
                            </div>
                            <div className="form-group" style={{ marginBottom: 0 }}>
                                <label>Tr·∫°ng th√°i</label>
                                <select
                                    value={filters.status}
                                    onChange={(e) => setFilters({ ...filters, status: e.target.value })}
                                >
                                    <option value="">T·∫•t c·∫£</option>
                                    <option value="new">Ch∆∞a xem</option>
                                    <option value="resolved">ƒê√£ gi·∫£i quy·∫øt</option>
                                </select>
                            </div>
                            <div className="form-group" style={{ marginBottom: 0 }}>
                                <label>T√¨m ki·∫øm</label>
                                <input
                                    type="text"
                                    placeholder="T√™n, SƒêT, n·ªôi dung..."
                                    value={filters.search}
                                    onChange={(e) => setFilters({ ...filters, search: e.target.value })}
                                />
                            </div>
                        </div>
                    </div>

                    <div className="card">
                        <h3 style={{ marginBottom: '15px', color: '#667eea', fontSize: '16px' }}>
                            üìã G√≥p √ù ({filteredFeedbacks.length})
                        </h3>
                        
                        {filteredFeedbacks.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üì≠</div>
                                <h3>Kh√¥ng C√≥ G√≥p √ù</h3>
                                <p>Ch∆∞a c√≥ g√≥p √Ω n√†o ph√π h·ª£p</p>
                            </div>
                        ) : (
                            <div className="feedback-list">
                                {filteredFeedbacks.map(feedback => (
                                    <div key={feedback.id} className={`feedback-item ${feedback.satisfaction}`}>
                                        {/* Header: T√™n, SƒêT, Ph√≤ng, Th·ªùi gian */}
                                        <div className="feedback-meta">
                                            <span>üë§ <strong>{feedback.name}</strong></span>
                                            <span>üì± {feedback.phone}</span>
                                            <span>üè• {feedback.room}</span>
                                            <span>üïí {new Date(feedback.createdAt).toLocaleString('vi-VN', { 
                                                day: '2-digit', 
                                                month: '2-digit', 
                                                hour: '2-digit', 
                                                minute: '2-digit' 
                                            })}</span>
                                        </div>
                                        
                                        {/* Emoji + Status Badge */}
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginTop: '8px' }}>
                                            <span style={{ fontSize: '24px' }}>
                                                {feedback.satisfaction === 'happy' && 'üòä'}
                                                {feedback.satisfaction === 'neutral' && 'üòê'}
                                                {feedback.satisfaction === 'sad' && 'üòû'}
                                            </span>
                                            <span className={`status-badge status-${feedback.status}`}>
                                                {feedback.status === 'new' && 'üÜï M·ªõi'}
                                                {feedback.status === 'processing' && '‚è≥ X·ª≠ l√Ω'}
                                                {feedback.status === 'resolved' && '‚úÖ Xong'}
                                            </span>
                                        </div>

                                        {/* N·ªôi dung */}
                                        <div className="feedback-content">
                                            <strong>üí¨ N·ªôi dung:</strong>
                                            <p>{feedback.content}</p>
                                            
                                            {feedback.resolvedAt && (
                                                <div style={{ 
                                                    marginTop: '10px', 
                                                    padding: '8px', 
                                                    background: '#f7fafc', 
                                                    borderRadius: '6px',
                                                    fontSize: '13px',
                                                    color: '#718096'
                                                }}>
                                                    <div>‚úÖ Ho√†n t·∫•t: {new Date(feedback.resolvedAt).toLocaleString('vi-VN')}</div>
                                                </div>
                                            )}
                                            {feedback.assignTo && (
                                                <div style={{ 
                                                    marginTop: '10px', 
                                                    padding: '10px', 
                                                    background: '#fff3cd', 
                                                    borderRadius: '6px',
                                                    borderLeft: '4px solid #ffc107'
                                                }}>
                                                    <strong style={{ color: '#856404' }}>üîÑ ƒê∆∞·ª£c chuy·ªÉn cho:</strong>
                                                    <p style={{ margin: '5px 0 0 0', color: '#2d3748', fontWeight: '600' }}>{feedback.assignTo}</p>
                                                    {feedback.transferHistory && feedback.transferHistory.length > 0 && (
                                                        <div style={{ fontSize: '13px', color: '#718096', marginTop: '8px' }}>
                                                            <strong>L·ªãch s·ª≠ chuy·ªÉn:</strong>
                                                            {feedback.transferHistory.map((transfer, index) => (
                                                                <div key={index} style={{ marginTop: '5px', paddingLeft: '10px', borderLeft: '2px solid #ddd' }}>
                                                                    <div>‚Üí {transfer.to}</div>
                                                                    <div style={{ fontSize: '12px', fontStyle: 'italic' }}>
                                                                        L√Ω do: {transfer.reason}
                                                                    </div>
                                                                    <div style={{ fontSize: '11px' }}>
                                                                        üïí {new Date(transfer.transferredAt).toLocaleString('vi-VN')}
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                            {feedback.response && (
                                                <div style={{ 
                                                    marginTop: '10px', 
                                                    padding: '10px', 
                                                    background: '#e6ffed', 
                                                    borderRadius: '6px',
                                                    borderLeft: '4px solid #48bb78'
                                                }}>
                                                    <strong style={{ color: '#2d8659' }}>üìù ƒê√£ ph·∫£n h·ªìi:</strong>
                                                    <p style={{ margin: '5px 0 0 0', color: '#2d3748' }}>{feedback.response}</p>
                                                    {feedback.responseAt && (
                                                        <div style={{ fontSize: '12px', color: '#718096', marginTop: '5px' }}>
                                                            üïí {new Date(feedback.responseAt).toLocaleString('vi-VN')}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </div>

                                        {/* Action Buttons - ·ªû D∆Ø·ªöI */}
                                        <div className="feedback-actions">
                                            {feedback.status === 'new' && (
                                                <>
                                                    <button
                                                        className="btn btn-success"
                                                        onClick={() => openResponseModal(feedback.id)}
                                                    >
                                                        üí¨ Ph·∫£n h·ªìi & K·∫øt th√∫c
                                                    </button>
                                                    <button
                                                        className="btn btn-secondary"
                                                        onClick={() => openTransferModal(feedback.id)}
                                                    >
                                                        üîÑ Chuy·ªÉn
                                                    </button>
                                                </>
                                            )}
                                            {feedback.status === 'resolved' && (
                                                <button
                                                    className="btn btn-warning"
                                                    onClick={() => updateStatus(feedback.id, 'new')}
                                                >
                                                    ‚Ü©Ô∏è M·ªü l·∫°i
                                                </button>
                                            )}
                                            <button
                                                className="btn btn-danger"
                                                onClick={() => deleteFeedback(feedback.id)}
                                            >
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Response Modal */}
                    {responseModal.show && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0,0,0,0.5)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 1000,
                            padding: '20px'
                        }}>
                            <div style={{
                                background: 'white',
                                borderRadius: '12px',
                                padding: '30px',
                                maxWidth: '600px',
                                width: '100%',
                                boxShadow: '0 10px 40px rgba(0,0,0,0.2)'
                            }}>
                                <h2 style={{ 
                                    color: '#667eea', 
                                    marginBottom: '20px',
                                    fontSize: '22px'
                                }}>
                                    üí¨ Ph·∫£n H·ªìi Kh√°ch H√†ng
                                </h2>
                                
                                <div style={{ marginBottom: '20px' }}>
                                    <label style={{ 
                                        display: 'block', 
                                        marginBottom: '10px',
                                        fontWeight: '600',
                                        color: '#2d3748'
                                    }}>
                                        N·ªôi dung ph·∫£n h·ªìi: <span style={{ color: '#f56565' }}>*</span>
                                    </label>
                                    <textarea
                                        value={responseModal.response}
                                        onChange={(e) => setResponseModal({
                                            ...responseModal,
                                            response: e.target.value
                                        })}
                                        placeholder="Nh·∫≠p n·ªôi dung ƒë√£ ph·∫£n h·ªìi cho kh√°ch h√†ng..."
                                        style={{
                                            width: '100%',
                                            minHeight: '150px',
                                            padding: '12px',
                                            borderRadius: '8px',
                                            border: '2px solid #e2e8f0',
                                            fontSize: '15px',
                                            fontFamily: 'inherit',
                                            resize: 'vertical'
                                        }}
                                    />
                                    <div style={{ 
                                        fontSize: '13px', 
                                        color: '#718096',
                                        marginTop: '8px'
                                    }}>
                                        üí° Ghi r√µ b·∫°n ƒë√£ gi·∫£i quy·∫øt nh∆∞ th·∫ø n√†o, ƒë√£ l√†m g√¨ ƒë·ªÉ kh·∫Øc ph·ª•c
                                    </div>
                                </div>

                                <div style={{ 
                                    display: 'flex', 
                                    gap: '10px',
                                    justifyContent: 'flex-end'
                                }}>
                                    <button
                                        className="btn btn-secondary"
                                        onClick={closeResponseModal}
                                        style={{ minWidth: '100px' }}
                                    >
                                        ‚ùå H·ªßy
                                    </button>
                                    <button
                                        className="btn btn-success"
                                        onClick={saveResponse}
                                        style={{ minWidth: '150px' }}
                                    >
                                        ‚úÖ L∆∞u & K·∫øt th√∫c
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Transfer Modal */}
                    {transferModal.show && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0,0,0,0.5)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 1000,
                            padding: '20px'
                        }}>
                            <div style={{
                                background: 'white',
                                borderRadius: '12px',
                                padding: '30px',
                                maxWidth: '600px',
                                width: '100%',
                                boxShadow: '0 10px 40px rgba(0,0,0,0.2)'
                            }}>
                                <h2 style={{ 
                                    color: '#f59e0b', 
                                    marginBottom: '20px',
                                    fontSize: '22px'
                                }}>
                                    üîÑ Chuy·ªÉn X·ª≠ L√Ω
                                </h2>
                                
                                <div style={{ marginBottom: '20px' }}>
                                    <label style={{ 
                                        display: 'block', 
                                        marginBottom: '10px',
                                        fontWeight: '600',
                                        color: '#2d3748'
                                    }}>
                                        Chuy·ªÉn ƒë·∫øn Khoa/Ph√≤ng: <span style={{ color: '#f56565' }}>*</span>
                                    </label>
                                    <select
                                        value={transferModal.assignTo}
                                        onChange={(e) => setTransferModal({
                                            ...transferModal,
                                            assignTo: e.target.value
                                        })}
                                        style={{
                                            width: '100%',
                                            padding: '12px',
                                            borderRadius: '8px',
                                            border: '2px solid #e2e8f0',
                                            fontSize: '15px',
                                            backgroundColor: 'white',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        <option value="">-- Ch·ªçn Khoa/Ph√≤ng --</option>
                                        <option value="Ph√≤ng K·∫ø ho·∫°ch t·ªïng h·ª£p">Ph√≤ng K·∫ø ho·∫°ch t·ªïng h·ª£p</option>
                                        <option value="Ph√≤ng ƒêi·ªÅu d∆∞·ª°ng">Ph√≤ng ƒêi·ªÅu d∆∞·ª°ng</option>
                                        <option value="Ph√≤ng T·ªï ch·ª©c c√°n b·ªô">Ph√≤ng T·ªï ch·ª©c c√°n b·ªô</option>
                                        <option value="Ph√≤ng H√†nh ch√≠nh qu·∫£n tr·ªã">Ph√≤ng H√†nh ch√≠nh qu·∫£n tr·ªã</option>
                                        <option value="Ph√≤ng T√†i ch√≠nh k·∫ø to√°n">Ph√≤ng T√†i ch√≠nh k·∫ø to√°n</option>
                                        <option value="Ph√≤ng Ch·ªâ ƒë·∫°o tuy·∫øn">Ph√≤ng Ch·ªâ ƒë·∫°o tuy·∫øn</option>
                                        <option value="Ph√≤ng V·∫≠t t∆∞ thi·∫øt b·ªã y t·∫ø">Ph√≤ng V·∫≠t t∆∞ thi·∫øt b·ªã y t·∫ø</option>
                                        <option value="Ph√≤ng Qu·∫£n l√Ω ch·∫•t l∆∞·ª£ng">Ph√≤ng Qu·∫£n l√Ω ch·∫•t l∆∞·ª£ng</option>
                                        <option value="Ph√≤ng C√¥ng t√°c x√£ h·ªôi">Ph√≤ng C√¥ng t√°c x√£ h·ªôi</option>
                                        <option value="Khoa Kh√°m ch·ªØa b·ªánh TYC">Khoa Kh√°m ch·ªØa b·ªánh TYC</option>
                                        <option value="Khoa Kh√°m b·ªánh">Khoa Kh√°m b·ªánh</option>
                                        <option value="Khoa N·ªôi t·ªïng h·ª£p">Khoa N·ªôi t·ªïng h·ª£p</option>
                                        <option value="Khoa N·ªôi H√¥ h·∫•p">Khoa N·ªôi H√¥ h·∫•p</option>
                                        <option value="Khoa N·ªôi Ti√™u h√≥a">Khoa N·ªôi Ti√™u h√≥a</option>
                                        <option value="Khoa N·ªôi Tim m·∫°ch">Khoa N·ªôi Tim m·∫°ch</option>
                                        <option value="Khoa Truy·ªÅn nhi·ªÖm">Khoa Truy·ªÅn nhi·ªÖm</option>
                                        <option value="Khoa S·ªët xu·∫•t huy·∫øt">Khoa S·ªët xu·∫•t huy·∫øt</option>
                                        <option value="Khoa 3 Chuy√™n khoa">Khoa 3 Chuy√™n khoa</option>
                                        <option value="Khoa S∆° sinh">Khoa S∆° sinh</option>
                                        <option value="Khoa Dinh d∆∞·ª°ng">Khoa Dinh d∆∞·ª°ng</option>
                                        <option value="Khoa H·ªìi s·ª©c t√≠ch c·ª±c ‚Äì Ch·ªëng ƒë·ªôc">Khoa H·ªìi s·ª©c t√≠ch c·ª±c ‚Äì Ch·ªëng ƒë·ªôc</option>
                                        <option value="Khoa C·∫•p c·ª©u">Khoa C·∫•p c·ª©u</option>
                                        <option value="Khoa Ngo·∫°i">Khoa Ngo·∫°i</option>
                                        <option value="Khoa G√¢y m√™ h·ªìi s·ª©c">Khoa G√¢y m√™ h·ªìi s·ª©c</option>
                                        <option value="Khoa Ch·∫•n th∆∞∆°ng Ch·ªânh h√¨nh">Khoa Ch·∫•n th∆∞∆°ng Ch·ªânh h√¨nh</option>
                                        <option value="Khoa V·∫≠t l√Ω tr·ªã li·ªáu">Khoa V·∫≠t l√Ω tr·ªã li·ªáu</option>
                                        <option value="Khoa X√©t nghi·ªám">Khoa X√©t nghi·ªám</option>
                                        <option value="Khoa Ch·∫©n ƒëo√°n h√¨nh ·∫£nh">Khoa Ch·∫©n ƒëo√°n h√¨nh ·∫£nh</option>
                                        <option value="Khoa Ki·ªÉm so√°t nhi·ªÖm khu·∫©n">Khoa Ki·ªÉm so√°t nhi·ªÖm khu·∫©n</option>
                                        <option value="Khoa D∆∞·ª£c">Khoa D∆∞·ª£c</option>
                                    </select>
                                </div>

                                <div style={{ marginBottom: '20px' }}>
                                    <label style={{ 
                                        display: 'block', 
                                        marginBottom: '10px',
                                        fontWeight: '600',
                                        color: '#2d3748'
                                    }}>
                                        L√Ω do chuy·ªÉn: <span style={{ color: '#f56565' }}>*</span>
                                    </label>
                                    <textarea
                                        value={transferModal.reason}
                                        onChange={(e) => setTransferModal({
                                            ...transferModal,
                                            reason: e.target.value
                                        })}
                                        placeholder="Nh·∫≠p l√Ω do chuy·ªÉn x·ª≠ l√Ω..."
                                        style={{
                                            width: '100%',
                                            minHeight: '120px',
                                            padding: '12px',
                                            borderRadius: '8px',
                                            border: '2px solid #e2e8f0',
                                            fontSize: '15px',
                                            fontFamily: 'inherit',
                                            resize: 'vertical'
                                        }}
                                    />
                                    <div style={{ 
                                        fontSize: '13px', 
                                        color: '#718096',
                                        marginTop: '8px'
                                    }}>
                                        üí° VD: "Thu·ªôc chuy√™n m√¥n c·ªßa khoa N·ªôi", "C·∫ßn b√°c sƒ© chuy√™n khoa x·ª≠ l√Ω"
                                    </div>
                                </div>

                                <div style={{ 
                                    display: 'flex', 
                                    gap: '10px',
                                    justifyContent: 'flex-end'
                                }}>
                                    <button
                                        className="btn btn-secondary"
                                        onClick={closeTransferModal}
                                        style={{ minWidth: '100px' }}
                                    >
                                        ‚ùå H·ªßy
                                    </button>
                                    <button
                                        className="btn btn-warning"
                                        onClick={saveTransfer}
                                        style={{ minWidth: '120px' }}
                                    >
                                        üîÑ Chuy·ªÉn
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        // Reports Component
        function Reports() {
            const [feedbacks, setFeedbacks] = useState([]);
            const [loading, setLoading] = useState(true);
            const [dateRange, setDateRange] = useState({
                from: '',
                to: ''
            });
            const [stats, setStats] = useState({
                total: 0,
                happy: 0,
                neutral: 0,
                sad: 0,
                new: 0,
                processing: 0,
                resolved: 0
            });

            useEffect(() => {
                const feedbackRef = db.ref('feedbacks');
                feedbackRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const feedbackList = Object.entries(data).map(([id, feedback]) => ({
                            id,
                            ...feedback
                        })).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        
                        setFeedbacks(feedbackList);
                        
                        const newStats = {
                            total: feedbackList.length,
                            happy: feedbackList.filter(f => f.satisfaction === 'happy').length,
                            neutral: feedbackList.filter(f => f.satisfaction === 'neutral').length,
                            sad: feedbackList.filter(f => f.satisfaction === 'sad').length,
                            new: feedbackList.filter(f => f.status === 'new').length,
                            resolved: feedbackList.filter(f => f.status === 'resolved').length
                        };
                        setStats(newStats);
                    }
                    setLoading(false);
                });

                return () => feedbackRef.off();
            }, []);

            const getFilteredFeedbacks = () => {
                if (!dateRange.from && !dateRange.to) {
                    return feedbacks;
                }

                return feedbacks.filter(feedback => {
                    const feedbackDate = new Date(feedback.createdAt);
                    const fromDate = dateRange.from ? new Date(dateRange.from) : null;
                    const toDate = dateRange.to ? new Date(dateRange.to + 'T23:59:59') : null;

                    if (fromDate && feedbackDate < fromDate) return false;
                    if (toDate && feedbackDate > toDate) return false;
                    return true;
                });
            };

            const exportToExcel = () => {
                const filteredData = getFilteredFeedbacks();
                
                // Prepare data for Excel
                const excelData = filteredData.map((feedback, index) => {
                    // Calculate processing time in minutes
                    let processingTime = '';
                    if (feedback.resolvedAt && feedback.createdAt) {
                        const minutes = Math.round((new Date(feedback.resolvedAt) - new Date(feedback.createdAt)) / (1000 * 60));
                        processingTime = `${minutes} ph√∫t`;
                    }
                    
                    return {
                        'STT': index + 1,
                        'Ng√†y gi·ªù nh·∫≠n': new Date(feedback.createdAt).toLocaleString('vi-VN'),
                        'H·ªç t√™n': feedback.name || 'Kh√¥ng c√≥',
                        'S·ªë ƒëi·ªán tho·∫°i': feedback.phone || 'Kh√¥ng cung c·∫•p',
                        'Ph√≤ng/Bu·ªìng': feedback.room,
                        'M·ª©c ƒë·ªô h√†i l√≤ng': feedback.satisfaction === 'happy' ? 'H√†i l√≤ng' : 
                                           feedback.satisfaction === 'neutral' ? 'B√¨nh th∆∞·ªùng' : 'Kh√¥ng h√†i l√≤ng',
                        'N·ªôi dung g√≥p √Ω': feedback.content,
                        'Tr·∫°ng th√°i': feedback.status === 'new' ? 'M·ªõi' : 'ƒê√£ gi·∫£i quy·∫øt',
                        'ƒê∆∞·ª£c chuy·ªÉn cho': feedback.assignTo || '',
                        'L√Ω do chuy·ªÉn': feedback.transferHistory && feedback.transferHistory.length > 0 ? 
                                        feedback.transferHistory[feedback.transferHistory.length - 1].reason : '',
                        'Th·ªùi gian chuy·ªÉn': feedback.lastTransferAt ? new Date(feedback.lastTransferAt).toLocaleString('vi-VN') : '',
                        'N·ªôi dung ph·∫£n h·ªìi': feedback.response || '',
                        'Th·ªùi gian ho√†n t·∫•t': feedback.resolvedAt ? new Date(feedback.resolvedAt).toLocaleString('vi-VN') : '',
                        'Th·ªùi gian x·ª≠ l√Ω': processingTime
                    };
                });

                // Create workbook
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(excelData);

                // Set column widths
                ws['!cols'] = [
                    { wch: 5 },  // STT
                    { wch: 18 }, // Ng√†y gi·ªù nh·∫≠n
                    { wch: 25 }, // H·ªç t√™n
                    { wch: 15 }, // SƒêT
                    { wch: 15 }, // Ph√≤ng
                    { wch: 18 }, // M·ª©c ƒë·ªô
                    { wch: 50 }, // N·ªôi dung g√≥p √Ω
                    { wch: 15 }, // Tr·∫°ng th√°i
                    { wch: 25 }, // ƒê∆∞·ª£c chuy·ªÉn cho
                    { wch: 40 }, // L√Ω do chuy·ªÉn
                    { wch: 18 }, // Th·ªùi gian chuy·ªÉn
                    { wch: 50 }, // N·ªôi dung ph·∫£n h·ªìi
                    { wch: 18 }, // Th·ªùi gian ho√†n t·∫•t
                    { wch: 15 }  // Th·ªùi gian x·ª≠ l√Ω
                ];

                XLSX.utils.book_append_sheet(wb, ws, 'G√≥p √Ω kh√°ch h√†ng');

                // Generate filename
                const fromStr = dateRange.from || 'all';
                const toStr = dateRange.to || 'all';
                const filename = `Bao-cao-gop-y_${fromStr}_${toStr}.xlsx`;

                // Download
                XLSX.writeFile(wb, filename);
            };

            const exportToPDF = () => {
                const filteredData = getFilteredFeedbacks();
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Add Vietnamese font support (using default fonts with Latin characters)
                doc.setFont('helvetica');

                // Title
                doc.setFontSize(18);
                doc.text('BAO CAO GOP Y KHACH HANG', 105, 20, { align: 'center' });
                doc.setFontSize(14);
                doc.text('BENH VIEN NHI DONG TP CAN THO', 105, 30, { align: 'center' });
                doc.setFontSize(10);
                doc.text('Cho tre suc khoe - Cho tre tuong lai', 105, 38, { align: 'center' });

                // Date range
                doc.setFontSize(11);
                const dateRangeText = dateRange.from && dateRange.to 
                    ? `Tu ngay: ${dateRange.from} - Den ngay: ${dateRange.to}`
                    : 'Tat ca thoi gian';
                doc.text(dateRangeText, 105, 48, { align: 'center' });

                // Statistics
                doc.setFontSize(12);
                let yPos = 60;
                doc.text('THONG KE TONG QUAN:', 20, yPos);
                yPos += 10;
                
                doc.setFontSize(10);
                doc.text(`Tong so gop y: ${stats.total}`, 30, yPos);
                yPos += 7;
                doc.text(`Hai long: ${stats.happy} (${((stats.happy/stats.total)*100).toFixed(1)}%)`, 30, yPos);
                yPos += 7;
                doc.text(`Binh thuong: ${stats.neutral} (${((stats.neutral/stats.total)*100).toFixed(1)}%)`, 30, yPos);
                yPos += 7;
                doc.text(`Khong hai long: ${stats.sad} (${((stats.sad/stats.total)*100).toFixed(1)}%)`, 30, yPos);
                yPos += 10;
                
                doc.text(`Trang thai - Moi: ${stats.new}, Dang xu ly: ${stats.processing}, Da giai quyet: ${stats.resolved}`, 30, yPos);
                yPos += 15;

                // Table header
                doc.setFontSize(11);
                doc.text('DANH SACH CHI TIET:', 20, yPos);
                yPos += 10;

                // Add summary of feedbacks (first 20)
                doc.setFontSize(9);
                const maxItems = Math.min(filteredData.length, 20);
                
                for (let i = 0; i < maxItems; i++) {
                    const feedback = filteredData[i];
                    const date = new Date(feedback.createdAt).toLocaleString('vi-VN');
                    const satisfaction = feedback.satisfaction === 'happy' ? 'Hai long' : 
                                       feedback.satisfaction === 'neutral' ? 'Binh thuong' : 'Khong hai long';
                    const status = feedback.status === 'new' ? 'Moi' : 'Da giai quyet';
                    
                    doc.text(`${i + 1}. ${date} - ${feedback.room} - ${satisfaction} [${status}]`, 25, yPos);
                    yPos += 5;
                    
                    // Content (truncated if too long)
                    let content = feedback.content;
                    if (content.length > 80) {
                        content = content.substring(0, 80) + '...';
                    }
                    doc.text(`   "${content}"`, 25, yPos);
                    yPos += 5;
                    
                    // Add timestamps if available
                    if (feedback.processingAt) {
                        const processingDate = new Date(feedback.processingAt).toLocaleString('vi-VN');
                        doc.text(`   Bat dau xu ly: ${processingDate}`, 25, yPos);
                        yPos += 5;
                    }
                    if (feedback.resolvedAt) {
                        const resolvedDate = new Date(feedback.resolvedAt).toLocaleString('vi-VN');
                        doc.text(`   Hoan tat: ${resolvedDate}`, 25, yPos);
                        yPos += 5;
                    }
                    
                    yPos += 3;

                    // Add new page if needed
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 20;
                    }
                }

                if (filteredData.length > 20) {
                    yPos += 5;
                    doc.text(`... va ${filteredData.length - 20} gop y khac (xem chi tiet trong file Excel)`, 25, yPos);
                }

                // Footer
                doc.setFontSize(8);
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.text(`Trang ${i}/${pageCount}`, 105, 290, { align: 'center' });
                    doc.text(`Ngay xuat: ${new Date().toLocaleString('vi-VN')}`, 20, 290);
                }

                // Save
                const fromStr = dateRange.from || 'all';
                const toStr = dateRange.to || 'all';
                const filename = `Bao-cao-gop-y_${fromStr}_${toStr}.pdf`;
                doc.save(filename);
            };

            const setQuickDateRange = (days) => {
                const today = new Date();
                const from = new Date();
                from.setDate(today.getDate() - days);
                
                setDateRange({
                    from: from.toISOString().split('T')[0],
                    to: today.toISOString().split('T')[0]
                });
            };

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <p>ƒêang t·∫£i...</p>
                    </div>
                );
            }

            const filteredData = getFilteredFeedbacks();
            const filteredStats = {
                total: filteredData.length,
                happy: filteredData.filter(f => f.satisfaction === 'happy').length,
                neutral: filteredData.filter(f => f.satisfaction === 'neutral').length,
                sad: filteredData.filter(f => f.satisfaction === 'sad').length
            };

            return (
                <div>
                    <div className="card">
                        <div style={{ 
                            display: 'flex', 
                            alignItems: 'center', 
                            gap: '20px',
                            marginBottom: '20px',
                            padding: '15px',
                            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                            borderRadius: '12px',
                            color: 'white'
                        }}>
                            <img 
                                src="logo.png" 
                                alt="Logo BVNƒê"
                                style={{ 
                                    width: '100px',
                                    height: 'auto',
                                    flexShrink: 0,
                                    background: 'white',
                                    borderRadius: '50%',
                                    padding: '5px'
                                }}
                                onError={(e) => { e.target.style.display = 'none' }}
                            />
                            <div style={{ flex: 1, textAlign: 'left' }}>
                                <h2 style={{ marginBottom: '8px', fontSize: '22px', color: 'white' }}>
                                    üìÑ XU·∫§T B√ÅO C√ÅO
                                </h2>
                                <h3 style={{ fontSize: '16px', color: 'white', margin: 0 }}>
                                    B·ªánh vi·ªán Nhi ƒë·ªìng TP C·∫ßn Th∆°
                                </h3>
                            </div>
                        </div>

                        {/* Quick filters */}
                        <div style={{ marginBottom: '20px' }}>
                            <h3 style={{ fontSize: '16px', marginBottom: '10px', color: '#667eea' }}>
                                ‚ö° Nhanh:
                            </h3>
                            <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                                <button className="btn btn-secondary" onClick={() => setQuickDateRange(7)}>
                                    7 ng√†y qua
                                </button>
                                <button className="btn btn-secondary" onClick={() => setQuickDateRange(30)}>
                                    30 ng√†y qua
                                </button>
                                <button className="btn btn-secondary" onClick={() => setQuickDateRange(90)}>
                                    3 th√°ng qua
                                </button>
                                <button className="btn btn-secondary" onClick={() => setDateRange({ from: '', to: '' })}>
                                    T·∫•t c·∫£
                                </button>
                            </div>
                        </div>

                        {/* Date range filter */}
                        <div style={{ marginBottom: '20px', padding: '15px', background: '#f7fafc', borderRadius: '10px' }}>
                            <h3 style={{ fontSize: '16px', marginBottom: '10px', color: '#667eea' }}>
                                üìÖ Ch·ªçn kho·∫£ng th·ªùi gian:
                            </h3>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' }}>
                                <div>
                                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: 600 }}>
                                        T·ª´ ng√†y:
                                    </label>
                                    <input
                                        type="date"
                                        value={dateRange.from}
                                        onChange={(e) => setDateRange({ ...dateRange, from: e.target.value })}
                                        style={{ 
                                            width: '100%', 
                                            padding: '10px', 
                                            borderRadius: '8px',
                                            border: '2px solid #e2e8f0'
                                        }}
                                    />
                                </div>
                                <div>
                                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: 600 }}>
                                        ƒê·∫øn ng√†y:
                                    </label>
                                    <input
                                        type="date"
                                        value={dateRange.to}
                                        onChange={(e) => setDateRange({ ...dateRange, to: e.target.value })}
                                        style={{ 
                                            width: '100%', 
                                            padding: '10px', 
                                            borderRadius: '8px',
                                            border: '2px solid #e2e8f0'
                                        }}
                                    />
                                </div>
                            </div>
                        </div>

                        {/* Statistics */}
                        <div style={{ 
                            marginBottom: '20px', 
                            padding: '20px', 
                            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                            borderRadius: '12px',
                            color: 'white'
                        }}>
                            <h3 style={{ fontSize: '18px', marginBottom: '15px' }}>
                                üìä Th·ªëng k√™ ({dateRange.from || 'T·∫•t c·∫£'} ‚Üí {dateRange.to || 'Hi·ªán t·∫°i'})
                            </h3>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '15px' }}>
                                <div style={{ background: 'rgba(255,255,255,0.2)', padding: '15px', borderRadius: '8px' }}>
                                    <div style={{ fontSize: '32px', fontWeight: 'bold' }}>{filteredStats.total}</div>
                                    <div style={{ fontSize: '14px' }}>T·ªïng g√≥p √Ω</div>
                                </div>
                                <div style={{ background: 'rgba(72,187,120,0.3)', padding: '15px', borderRadius: '8px' }}>
                                    <div style={{ fontSize: '32px', fontWeight: 'bold' }}>{filteredStats.happy}</div>
                                    <div style={{ fontSize: '14px' }}>
                                        H√†i l√≤ng ({filteredStats.total > 0 ? ((filteredStats.happy/filteredStats.total)*100).toFixed(1) : 0}%)
                                    </div>
                                </div>
                                <div style={{ background: 'rgba(237,137,54,0.3)', padding: '15px', borderRadius: '8px' }}>
                                    <div style={{ fontSize: '32px', fontWeight: 'bold' }}>{filteredStats.neutral}</div>
                                    <div style={{ fontSize: '14px' }}>
                                        B√¨nh th∆∞·ªùng ({filteredStats.total > 0 ? ((filteredStats.neutral/filteredStats.total)*100).toFixed(1) : 0}%)
                                    </div>
                                </div>
                                <div style={{ background: 'rgba(245,101,101,0.3)', padding: '15px', borderRadius: '8px' }}>
                                    <div style={{ fontSize: '32px', fontWeight: 'bold' }}>{filteredStats.sad}</div>
                                    <div style={{ fontSize: '14px' }}>
                                        Kh√¥ng h√†i l√≤ng ({filteredStats.total > 0 ? ((filteredStats.sad/filteredStats.total)*100).toFixed(1) : 0}%)
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Export buttons */}
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' }}>
                            <button 
                                className="btn btn-success"
                                onClick={exportToExcel}
                                style={{ fontSize: '16px', padding: '15px' }}
                            >
                                üìä Xu·∫•t Excel
                                <div style={{ fontSize: '12px', fontWeight: 'normal' }}>
                                    Danh s√°ch chi ti·∫øt
                                </div>
                            </button>
                            <button 
                                className="btn btn-danger"
                                onClick={exportToPDF}
                                style={{ fontSize: '16px', padding: '15px' }}
                            >
                                üìÑ Xu·∫•t PDF
                                <div style={{ fontSize: '12px', fontWeight: 'normal' }}>
                                    B√°o c√°o t·ªïng h·ª£p
                                </div>
                            </button>
                        </div>

                        {/* Preview */}
                        <div style={{ marginTop: '30px' }}>
                            <h3 style={{ fontSize: '16px', marginBottom: '10px', color: '#667eea' }}>
                                üëÄ Xem tr∆∞·ªõc ({filteredData.length} g√≥p √Ω):
                            </h3>
                            <div style={{ 
                                maxHeight: '400px', 
                                overflow: 'auto', 
                                background: '#f7fafc', 
                                padding: '15px',
                                borderRadius: '8px'
                            }}>
                                {filteredData.slice(0, 10).map((feedback, index) => (
                                    <div key={feedback.id} style={{ 
                                        padding: '10px',
                                        marginBottom: '10px',
                                        background: 'white',
                                        borderRadius: '6px',
                                        borderLeft: `4px solid ${
                                            feedback.satisfaction === 'happy' ? '#48bb78' :
                                            feedback.satisfaction === 'neutral' ? '#ed8936' : '#f56565'
                                        }`
                                    }}>
                                        <div style={{ fontSize: '13px', color: '#718096' }}>
                                            {index + 1}. {new Date(feedback.createdAt).toLocaleString('vi-VN')} - {feedback.room}
                                        </div>
                                        <div style={{ fontSize: '14px', marginTop: '5px' }}>
                                            {feedback.content.substring(0, 100)}{feedback.content.length > 100 ? '...' : ''}
                                        </div>
                                    </div>
                                ))}
                                {filteredData.length > 10 && (
                                    <div style={{ textAlign: 'center', padding: '10px', color: '#718096' }}>
                                        ... v√† {filteredData.length - 10} g√≥p √Ω kh√°c
                                    </div>
                                )}
                                {filteredData.length === 0 && (
                                    <div style={{ textAlign: 'center', padding: '40px', color: '#718096' }}>
                                        Kh√¥ng c√≥ g√≥p √Ω n√†o trong kho·∫£ng th·ªùi gian n√†y
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Login Component
        function Login({ setUser, setCurrentView }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);

                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    setCurrentView('qr');
                } catch (error) {
                    console.error('Login error:', error);
                    alert('ƒêƒÉng nh·∫≠p th·∫•t b·∫°i! Vui l√≤ng ki·ªÉm tra email v√† m·∫≠t kh·∫©u.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="login-container">
                    <div className="card">
                        <h2 style={{ textAlign: 'center', marginBottom: '25px', color: '#667eea', fontSize: '20px' }}>
                            üîê ƒêƒÉng Nh·∫≠p Qu·∫£n L√Ω
                        </h2>
                        <form onSubmit={handleLogin}>
                            <div className="form-group">
                                <label>üìß Email</label>
                                <input
                                    type="email"
                                    placeholder="Nh·∫≠p email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>üîë M·∫≠t Kh·∫©u</label>
                                <input
                                    type="password"
                                    placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            <button
                                type="submit"
                                className="btn btn-primary"
                                style={{ width: '100%', fontSize: '16px' }}
                                disabled={loading}
                            >
                                {loading ? '‚è≥ ƒêang ƒëƒÉng nh·∫≠p...' : 'üöÄ ƒêƒÉng Nh·∫≠p'}
                            </button>
                        </form>
                        <button
                            className="btn btn-secondary"
                            style={{ width: '100%', fontSize: '14px', marginTop: '10px' }}
                            onClick={() => setCurrentView('form')}
                        >
                            ‚Üê Quay l·∫°i
                        </button>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
